<!DOCTYPE html>
<html lang="en">
<head>
    <title>DULCEKAT</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://fonts.googleapis.com/css?family=Poppins:200,300,400,500,600,700,800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Lora:400,400i,700,700i&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Amatic+SC:400,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/open-iconic-bootstrap.min.css">
    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" href="css/owl.carousel.min.css">
    <link rel="stylesheet" href="css/owl.theme.default.min.css">
    <link rel="stylesheet" href="css/magnific-popup.css">
    <link rel="stylesheet" href="css/aos.css">
    <link rel="stylesheet" href="css/ionicons.min.css">
    <link rel="stylesheet" href="css/bootstrap-datepicker.css">
    <link rel="stylesheet" href="css/jquery.timepicker.css">
    <link rel="stylesheet" href="css/flaticon.css">
    <link rel="stylesheet" href="css/icomoon.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/mystyles.css">
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="app/mytopline.js"></script>
    <script src="app/myheader.js"></script>
    <script src="app/myhome.js"></script>
    <script src="app/myqualities.js"></script>
    <script src="app/myvegetables.js"></script>
    <script src="app/mydealofday.js"></script>
    <script src="app/myfooter.js"></script>
    <script src="app/mynewletter.js"></script>
    <script src="app/mylogos.js"></script>
    <script src="app/myitem.js"></script>
    <script src="app/utils/models.js"></script>

</head>
<body class="goto-here">

    <div id='appvue'>
        <mytopline></mytopline>
        <myheader></myheader>
        <myhome></myhome>
        <myqualities></myqualities>
        <!-- <myvegetables></myvegetables> -->
        <section class="ftco-section">
            <div class="container">
                <div class="row justify-content-center mb-3 pb-3">
                    <div class="col-md-12 heading-section text-center ">
                        <span class="subheading">Productos especiales</span>
                        <h2 class="mb-4">Nuestros productos</h2>
                        <!-- <p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia</p> -->
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <template v-for="producto in lista_productos">
                        <myitem :data="producto" @shopevent="handleShop($event)"></myitem>
                    </template>
                </div>
            </div>
        </section>
        <!-- <mydealofday></mydealofday> -->
        <hr>
        <!-- <mylogos></mylogos> -->
        <!-- <mynewletter></mynewletter> -->
        <myfooter></myfooter>
    </div>

    <script src="js/jquery.min.js"></script>
    <script src="js/jquery-migrate-3.0.1.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.easing.1.3.js"></script>
    <script src="js/jquery.waypoints.min.js"></script>
    <script src="js/jquery.stellar.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/jquery.magnific-popup.min.js"></script>
    <script src="js/aos.js"></script>
    <script src="js/jquery.animateNumber.min.js"></script>
    <script src="js/bootstrap-datepicker.js"></script>
    <script src="js/scrollax.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBVWaKrjvy3MaE7SQ74_uJiULgl1JY0H2s&sensor=false"></script>
    <script src="js/google-map.js"></script>
    <script src="js/main.js"></script>

    <script>
    new Vue({
        el: '#appvue',
        data: {
            lista_productos: [],
            items: [1,2,34,5,3],
            ayuda: null
        },
        methods: {
            handleShop(event) {
                let shopList = localStorage.getItem('shopList');
                console.log("handleShop -> shopList", shopList)
                if(!shopList) {
                    shopList = [];
                } else {
                    shopList = (typeof shopList == 'string') ? JSON.parse(shopList) : shopList;
                }
                console.log("handleShop -> shopList", shopList)
                const { id_producto } = event;
                const newProducto = event;

                const lista = shopList.filter(item => item.id_producto == id_producto);

                if (lista.length > 0) {
                    shopList = shopList.map(item => {
                        return {
                            ...item,
                            nro_productos: (item.id_producto == id_producto) ?
                                (item.nro_productos) ?
                                    (item.nro_productos + 1) : 0
                                : item.nro_productos
                        }
                    });
                } else {
                    const item = {
                        id_producto,
                        nro_productos: 1
                    };
                    shopList = [item,...shopList];
                }
                console.log("handleShop -> shopList", shopList)
                console.log('event', event)

                localStorage.setItem(
                    'shopList',
                    JSON.stringify(shopList)
                );

                const body = {
                    id_user : 1,
                    lista_productos: shopList
                }

            }
        },
        created: function () {

            let usuario  = localStorage.getItem('usuario');
            let shopList = localStorage.getItem('shopList');
            console.log("shopList", shopList);

            const self = this;
            // `this` hace referencia a la instancia vm
            fetch('http://127.0.0.1:8000/api/getListarProducto')
            .then(function(response) {
                return response.json();
            })
            .then(function(myJson) {
                let lista = myJson || [];
                console.log("lista", lista)
                lista = lista.map(prod => {
                    return new Item(prod);
                })
                self.lista_productos = self.lista_productos || [];
                self.lista_productos = [...self.lista_productos, ...lista];
            });
        }
    })

    </script>
</body>
</html>
